var e=Object.defineProperty,t=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,l=(t,n,o)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o,a=(e,a)=>{for(var i in a||(a={}))n.call(a,i)&&l(e,i,a[i]);if(t)for(var i of t(a))o.call(a,i)&&l(e,i,a[i]);return e},i=(e,t,n)=>new Promise(((o,l)=>{var a=e=>{try{s(n.next(e))}catch(t){l(t)}},i=e=>{try{s(n.throw(e))}catch(t){l(t)}},s=e=>e.done?o(e.value):Promise.resolve(e.value).then(a,i);s((n=n.apply(e,t)).next())}));import{u as s,s as r,k as u,S as c,T as d,t as f,c as m,bj as h,am as p,$ as v,A as b,a_ as y,b8 as F,P as g,r as A,_ as S,a0 as V,B,a1 as O,a5 as P,w as R,a6 as j,D as w,ao as M,aC as T,aB as E,aU as D,aa as I,a4 as C,b6 as x,ai as L}from"./vendor.84d2d683.js";import"./useFormItem.75e32247.js";/* empty css               */import{i as _,j as k,_ as Y,k as $,l as H}from"./FormAction.9732afc1.js";import{B as N,al as z,h as G,i as U,aE as X,aF as q,aG as K,ac as W,z as J,av as Q,aC as Z,p as ee,a as te,_ as ne,ag as oe,au as le}from"./index.2956b203.js";import{u as ae}from"./index.a66a0969.js";function ie({defaultValueRef:e,getSchema:t,formModel:n,getProps:o}){return{handleFormValues:function(e){var t,n;if(!N(e))return{};const l={};for(const a of Object.entries(e)){let[,e]=a;const[i]=a;if(!i||z(e)&&0===e.length||G(e))continue;const u=s(o).transformDateFunc;N(e)&&(e=null==u?void 0:u(e)),z(e)&&(null==(t=e[0])?void 0:t._isAMomentObject)&&(null==(n=e[1])?void 0:n._isAMomentObject)&&(e=e.map((e=>null==u?void 0:u(e)))),U(e)&&(e=e.trim()),r(l,i,e)}return function(e){const t=s(o).fieldMapToTime;if(!t||!Array.isArray(t))return e;for(const[n,[o,l],a="YYYY-MM-DD"]of t){if(!(n&&o&&l&&e[n]))continue;const[t,i]=e[n];e[o]=X(t).format(a),e[l]=X(i).format(a),Reflect.deleteProperty(e,n)}return e}(l)},initDefault:function(){const o=s(t),l={};o.forEach((e=>{const{defaultValue:t}=e;q(t)||(l[e.field]=t,n[e.field]=t)})),e.value=l}}}function se({emit:e,getProps:t,formModel:n,getSchema:o,defaultValueRef:l,formElRef:a,schemaRef:r,handleFormValues:u}){function c(e,t){if(U(e)){const o=t.findIndex((t=>t.field===e));-1!==o&&(delete n[e],t.splice(o,1))}}function d(e){return i(this,null,(function*(){var t;return null==(t=s(a))?void 0:t.validateFields(e)}))}function p(e){return i(this,null,(function*(){var t;return yield null==(t=s(a))?void 0:t.validate(e)}))}function v(e){return i(this,null,(function*(){var t;yield null==(t=s(a))?void 0:t.clearValidate(e)}))}function b(n){return i(this,null,(function*(){n&&n.preventDefault();const{submitFunc:o}=s(t);if(o&&G(o))return void(yield o());if(s(a))try{const t=yield p(),n=u(t);e("submit",n)}catch(l){throw new Error(l)}}))}return{handleSubmit:b,clearValidate:v,validate:p,validateFields:d,getFieldsValue:function(){return s(a)?u(f(s(n))):{}},updateSchema:function(e){return i(this,null,(function*(){let t=[];N(e)&&t.push(e),z(e)&&(t=[...e]);if(!t.every((e=>"Divider"===e.component||Reflect.has(e,"field")&&e.field)))return void Q("All children of the form Schema array that need to be updated must contain the `field` field");const n=[];t.forEach((e=>{s(o).forEach((t=>{if(t.field===e.field){const o=Z(t,e);n.push(o)}else n.push(t)}))})),r.value=h(n,"field")}))},resetSchema:function(e){return i(this,null,(function*(){let t=[];N(e)&&t.push(e),z(e)&&(t=[...e]);t.every((e=>"Divider"===e.component||Reflect.has(e,"field")&&e.field))?r.value=t:Q("All children of the form Schema array that need to be updated must contain the `field` field")}))},appendSchemaByField:function(e,t,n=!1){return i(this,null,(function*(){const l=m(s(o)),a=l.findIndex((e=>e.field===t));if(l.some((n=>n.field===t||e.field))){if(!t||-1===a||n)return n?l.unshift(e):l.push(e),void(r.value=l);-1!==a&&l.splice(a+1,0,e),r.value=l}}))},removeSchemaByFiled:function(e){return i(this,null,(function*(){const t=m(s(o));if(!e)return;let n=U(e)?[e]:e;U(e)&&(n=[e]);for(const e of n)c(e,t);r.value=t}))},resetFields:function(){return i(this,null,(function*(){const{resetFunc:o,submitOnReset:i}=s(t);o&&G(o)&&(yield o());s(a)&&(Object.keys(n).forEach((e=>{n[e]=l.value[e]})),v(),e("reset",f(n)),i&&b())}))},setFieldsValue:function(e){return i(this,null,(function*(){const t=s(o).map((e=>e.field)).filter(Boolean),l=[];Object.keys(e).forEach((a=>{const i=s(o).find((e=>e.field===a));let r=e[a];const u=Reflect.has(e,a);if(r=_(null==i?void 0:i.component,r),u&&t.includes(a)){if(function(e){return s(o).some((t=>t.field===e&&k.includes(t.component)))}(a))if(Array.isArray(r)){const e=[];for(const t of r)e.push(t?X(t):null);n[a]=e}else{const{componentProps:e}=i||{};let t=e;"function"==typeof e&&(t=t({formModel:n})),n[a]=r?(null==t?void 0:t.valueFormat)?r:X(r):null}else n[a]=r;l.push(a)}})),d(l).catch((e=>{}))}))},scrollToField:function(e,t){return i(this,null,(function*(){var n;yield null==(n=s(a))?void 0:n.scrollToField(e,t)}))}}}var re=ne(b({name:"BasicForm",components:{FormItem:Y,Form:y,Row:F,FormAction:$},props:{model:{type:Object,default:{}},labelWidth:{type:[Number,String],default:0},fieldMapToTime:{type:Array,default:()=>[]},compact:ee.bool,schemas:{type:[Array],default:()=>[]},mergeDynamicData:{type:Object,default:null},baseRowStyle:{type:Object},baseColProps:{type:Object},autoSetPlaceHolder:ee.bool.def(!0),autoSubmitOnEnter:ee.bool.def(!1),submitOnReset:ee.bool,size:ee.oneOf(["default","small","large"]).def("default"),disabled:ee.bool,emptySpan:{type:[Number,Object],default:0},showAdvancedButton:ee.bool,transformDateFunc:{type:Function,default:e=>e._isAMomentObject?null==e?void 0:e.format("YYYY-MM-DD HH:mm:ss"):e},rulesMessageJoinLabel:ee.bool.def(!0),autoAdvancedLine:ee.number.def(3),alwaysShowLines:ee.number.def(1),showActionButtonGroup:ee.bool.def(!0),actionColOptions:Object,showResetButton:ee.bool.def(!0),autoFocusFirstItem:ee.bool,resetButtonOptions:Object,showSubmitButton:ee.bool.def(!0),submitButtonOptions:Object,resetFunc:Function,submitFunc:Function,hideRequiredMark:ee.bool,labelCol:Object,layout:ee.oneOf(["horizontal","vertical","inline"]).def("horizontal"),tableAction:{type:Object},wrapperCol:Object,colon:ee.bool,labelAlign:ee.string,rowProps:Object},emits:["advanced-change","reset","submit","register"],setup(e,{emit:t,attrs:n}){const o=g({}),l=ae(),r=g({isAdvanced:!0,hideAdvanceBtn:!1,isLoad:!1,actionSpan:6}),f=A({}),m=A(!1),h=A({}),b=A(null),y=A(null),{prefixCls:F}=te("basic-form"),V=u((()=>a(a({},e),s(h)))),B=u((()=>[F,{[`${F}--compact`]:s(V).compact}])),O=u((()=>{const{baseRowStyle:e={},rowProps:t}=s(V);return a({style:e},t)})),P=u((()=>a(a(a({},n),e),s(V)))),R=u((()=>{const e=s(b)||s(V).schemas;for(const t of e){const{defaultValue:e,component:n}=t;if(e&&k.includes(n))if(Array.isArray(e)){const n=[];e.forEach((e=>{n.push(X(e))})),t.defaultValue=n}else t.defaultValue=X(e)}return s(V).showAdvancedButton?e.filter((e=>"Divider"!==e.component)):e})),{handleToggleAdvanced:j}=function({advanceState:e,emit:t,getProps:n,getSchema:o,formModel:l,defaultValueRef:i}){const{realWidthRef:r,screenEnum:f,screenRef:m}=K(),h=u((()=>{if(!e.isAdvanced)return 0;const t=s(n).emptySpan||0;if(W(t))return t;if(N(t)){const{span:e=0}=t;return t[s(m).toLowerCase()]||e||0}return 0})),p=d((function(){let r=0,u=0;const{baseColProps:c={}}=s(n);for(const e of s(o)){const{show:t,colProps:n}=e;let o=!0;if(J(t)&&(o=t),G(t)&&(o=t({schema:e,model:l,field:e.field,values:a(a({},s(i)),l)})),o&&(n||c)){const{itemColSum:t,isAdvanced:o}=v(a(a({},c),n),r);r=t||0,o&&(u=r),e.isAdvanced=o}}e.actionSpan=u%24+s(h),v(s(n).actionColOptions||{span:24},r,!0),t("advanced-change")}),30);function v(t,o=0,l=!1){const a=s(r),i=parseInt(t.md)||parseInt(t.xs)||parseInt(t.sm)||t.span||24,u=parseInt(t.lg)||i,c=parseInt(t.xl)||u,d=parseInt(t.xxl)||c;return a<=f.LG?o+=i:a<f.XL?o+=u:a<f.XXL?o+=c:o+=d,l?(e.hideAdvanceBtn=!1,o<=48?(e.hideAdvanceBtn=!0,e.isAdvanced=!0):o>48&&o<=24*(s(n).autoAdvancedLine||3)?e.hideAdvanceBtn=!1:e.isLoad||(e.isLoad=!0,e.isAdvanced=!e.isAdvanced),{isAdvanced:e.isAdvanced,itemColSum:o}):o>24*(s(n).alwaysShowLines||1)?{isAdvanced:e.isAdvanced,itemColSum:o}:{isAdvanced:!0,itemColSum:o}}return c([()=>s(o),()=>e.isAdvanced,()=>s(r)],(()=>{const{showAdvancedButton:e}=s(n);e&&p()}),{immediate:!0}),{handleToggleAdvanced:function(){e.isAdvanced=!e.isAdvanced}}}({advanceState:r,emit:t,getProps:V,getSchema:R,formModel:o,defaultValueRef:f}),{handleFormValues:w,initDefault:M}=ie({getProps:V,defaultValueRef:f,getSchema:R,formModel:o});!function(e){i(this,arguments,(function*({getSchema:e,getProps:t,formElRef:n,isInitedDefault:o}){p((()=>i(this,null,(function*(){if(s(o)||!s(t).autoFocusFirstItem)return;yield v();const l=s(e),a=s(n),i=null==a?void 0:a.$el;if(!a||!i||!l||0===l.length)return;if(!l[0].component.includes("Input"))return;const r=i.querySelector(".ant-row:first-child input");r&&(null==r||r.focus())}))))}))}({getSchema:R,getProps:V,isInitedDefault:m,formElRef:y});const{handleSubmit:T,setFieldsValue:E,clearValidate:D,validate:I,validateFields:C,getFieldsValue:x,updateSchema:L,resetSchema:_,appendSchemaByField:Y,removeSchemaByFiled:$,resetFields:z,scrollToField:U}=se({emit:t,getProps:V,formModel:o,getSchema:R,defaultValueRef:f,formElRef:y,schemaRef:b,handleFormValues:w});H({resetAction:z,submitAction:T}),c((()=>s(V).model),(()=>{const{model:e}=s(V);e&&E(e)}),{immediate:!0}),c((()=>s(V).schemas),(e=>{_(null!=e?e:[])})),c((()=>R.value),(e=>{v((()=>{var e;null==(e=null==l?void 0:l.redoModalHeight)||e.call(l)})),s(m)||(null==e?void 0:e.length)&&(M(),m.value=!0)}));const q={getFieldsValue:x,setFieldsValue:E,resetFields:z,updateSchema:L,resetSchema:_,setProps:function(e){return i(this,null,(function*(){h.value=Z(s(h)||{},e)}))},removeSchemaByFiled:$,appendSchemaByField:Y,clearValidate:D,validateFields:C,validate:I,submit:T,scrollToField:U};return S((()=>{M(),t("register",q)})),a({getBindValue:P,handleToggleAdvanced:j,handleEnterPress:function(e){const{autoSubmitOnEnter:t}=s(V);if(t&&"Enter"===e.key&&e.target&&e.target instanceof HTMLElement){const t=e.target;t&&t.tagName&&"INPUT"==t.tagName.toUpperCase()&&T()}},formModel:o,defaultValueRef:f,advanceState:r,getRow:O,getProps:V,formElRef:y,getSchema:R,formActionType:q,setFormModel:function(e,t){o[e]=t;const{validateTrigger:n}=s(P);n&&"change"!==n||C([e]).catch((e=>{}))},getFormClass:B,getFormActionBindProps:u((()=>a(a({},V.value),r)))},q)}}),[["render",function(e,t,n,o,l,a){const i=V("FormItem"),s=V("FormAction"),r=V("Row"),u=V("Form");return B(),O(u,C(e.getBindValue,{class:e.getFormClass,ref:"formElRef",model:e.formModel,onKeypress:x(e.handleEnterPress,["enter"])}),{default:P((()=>[R(r,E(D(e.getRow)),{default:P((()=>[j(e.$slots,"formHeader"),(B(!0),w(I,null,M(e.getSchema,(t=>(B(),O(i,{key:t.field,tableAction:e.tableAction,formActionType:e.formActionType,schema:t,formProps:e.getProps,allDefaultValues:e.defaultValueRef,formModel:e.formModel,setFormModel:e.setFormModel},T({_:2},[M(Object.keys(e.$slots),(t=>({name:t,fn:P((n=>[j(e.$slots,t,E(D(n||{})))]))})))]),1032,["tableAction","formActionType","schema","formProps","allDefaultValues","formModel","setFormModel"])))),128)),R(s,C(e.getFormActionBindProps,{onToggleAdvanced:e.handleToggleAdvanced}),T({_:2},[M(["resetBefore","submitBefore","advanceBefore","advanceAfter"],(t=>({name:t,fn:P((n=>[j(e.$slots,t,E(D(n||{})))]))})))]),1040,["onToggleAdvanced"]),j(e.$slots,"formFooter")])),_:3},16)])),_:3},16,["class","model","onKeypress"])}]]);function ue(e){const t=A(null),n=A(!1);function o(){return i(this,null,(function*(){const e=s(t);return e||Q("The form instance has not been obtained, please make sure that the form has been rendered when performing the form operation!"),yield v(),e}))}return[function(o){L((()=>{t.value=null,n.value=null})),s(n)&&oe()&&o===s(t)||(t.value=o,n.value=!0,c((()=>e),(()=>{e&&o.setProps(le(e))}),{immediate:!0,deep:!0}))},{scrollToField:(e,t)=>i(this,null,(function*(){(yield o()).scrollToField(e,t)})),setProps:e=>i(this,null,(function*(){(yield o()).setProps(e)})),updateSchema:e=>i(this,null,(function*(){(yield o()).updateSchema(e)})),resetSchema:e=>i(this,null,(function*(){(yield o()).resetSchema(e)})),clearValidate:e=>i(this,null,(function*(){(yield o()).clearValidate(e)})),resetFields:()=>i(this,null,(function*(){o().then((e=>i(this,null,(function*(){yield e.resetFields()}))))})),removeSchemaByFiled:e=>i(this,null,(function*(){var n;null==(n=s(t))||n.removeSchemaByFiled(e)})),getFieldsValue:()=>{var e;return null==(e=s(t))?void 0:e.getFieldsValue()},setFieldsValue:e=>i(this,null,(function*(){(yield o()).setFieldsValue(e)})),appendSchemaByField:(e,t,n)=>i(this,null,(function*(){(yield o()).appendSchemaByField(e,t,n)})),submit:()=>i(this,null,(function*(){return(yield o()).submit()})),validate:e=>i(this,null,(function*(){return(yield o()).validate(e)})),validateFields:e=>i(this,null,(function*(){return(yield o()).validateFields(e)}))}]}export{re as B,ue as u};
