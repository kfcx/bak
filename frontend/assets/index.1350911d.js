import{e as t,b as e,a as n,_ as a,h as o,f as s,w as r}from"./index.2956b203.js";import{r as u,af as i,u as l,A as c,aT as d,k as p,am as f,a0 as m,B as y,a1 as v,a5 as C,ad as g,J as S,a4 as b,aC as x,ao as h,a6 as w,aB as B,aU as F,w as z}from"./vendor.84d2d683.js";import{u as A}from"./useFormItem.75e32247.js";var T=a(c({name:"CountButton",components:{Button:d},props:{value:{type:[Object,Number,String,Array]},count:{type:Number,default:60},emailCode:{type:String,default:""},beforeStartFunc:{type:Function,default:null}},setup(a){const r=u(!1),c=t(),{currentCount:d,isStart:m,start:y,reset:v}=function(t){const e=u(t),n=u(!1);let a;function o(){a&&window.clearInterval(a)}function s(){n.value=!1,o(),a=null}function r(){l(n)||a||(n.value=!0,a=setInterval((()=>{1===l(e)?(s(),e.value=t):e.value-=1}),1e3))}function c(){e.value=t,s()}return i((()=>{c()})),{start:r,reset:c,restart:function(){c(),r()},clear:o,stop:s,currentCount:e,isStart:n}}(a.count),{t:C}=e(),{notification:g,createErrorModal:S}=s(),{prefixCls:b}=n("register"),x=p((()=>l(m)?C("component.countdown.sendText",[l(d)]):C("component.countdown.normalText")));return f((()=>{void 0===a.value&&v()})),{handleStart:function(){return t=this,e=null,n=function*(){const{beforeStartFunc:t}=a;if(t&&o(t)){r.value=!0;try{(yield t())&&y()}finally{r.value=!1}}else{const t=a.emailCode;if(!t)return void g.error({message:C("sys.api.operationFailed"),description:`${C("sys.login.emailPlaceholder")}`,duration:3});try{r.value=!0;const e=yield c.emailVerify({email:t,mode:"none"});e&&(y(),g.success({message:C("sys.login.registerSuccessTitle"),description:e,duration:3}))}catch(e){S({title:C("sys.api.errorTip"),content:e.message||C("sys.api.networkExceptionMsg"),getContainer:()=>document.body.querySelector(`.${b}`)||document.body})}finally{r.value=!1}}},new Promise(((a,o)=>{var s=t=>{try{u(n.next(t))}catch(e){o(e)}},r=t=>{try{u(n.throw(t))}catch(e){o(e)}},u=t=>t.done?a(t.value):Promise.resolve(t.value).then(s,r);u((n=n.apply(t,e)).next())}));var t,e,n},currentCount:d,loading:r,getButtonText:x,isStart:m}}}),[["render",function(t,e,n,a,o,s){const r=m("Button");return y(),v(r,b(t.$attrs,{disabled:t.isStart,onClick:t.handleStart,loading:t.loading}),{default:C((()=>[g(S(t.getButtonText),1)])),_:1},16,["disabled","onClick","loading"])}]]);const $=r(a(c({name:"CountDownInput",components:{CountButton:T},inheritAttrs:!1,props:{value:{type:String},size:{type:String,validator:t=>["default","large","small"].includes(t)},count:{type:Number,default:60},emailCode:{type:String,default:""},sendCodeApi:{type:Function,default:null}},setup(t){const{prefixCls:e}=n("countdown-input"),[a]=A(t);return{prefixCls:e,state:a}}}),[["render",function(t,e,n,a,o,s){const r=m("CountButton"),u=m("a-input");return y(),v(u,b(t.$attrs,{class:t.prefixCls,size:t.size,value:t.state}),x({addonAfter:C((()=>[z(r,{size:t.size,count:t.count,value:t.state,emailCode:t.emailCode,beforeStartFunc:t.sendCodeApi},null,8,["size","count","value","emailCode","beforeStartFunc"])])),_:2},[h(Object.keys(t.$slots).filter((t=>"addonAfter"!==t)),(e=>({name:e,fn:C((n=>[w(t.$slots,e,B(F(n||{})))]))})))]),1040,["class","size","value"])}]]));r(T);export{$ as C};
