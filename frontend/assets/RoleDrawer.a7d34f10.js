var e=Object.defineProperty,t=Object.defineProperties,l=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,c=(t,l,n)=>l in t?e(t,l,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[l]=n,r=(e,t)=>{for(var l in t||(t={}))a.call(t,l)&&c(e,l,t[l]);if(n)for(var l of n(t))s.call(t,l)&&c(e,l,t[l]);return e},o=(e,n)=>t(e,l(n)),i=(e,t,l)=>new Promise(((n,a)=>{var s=e=>{try{r(l.next(e))}catch(t){a(t)}},c=e=>{try{r(l.throw(e))}catch(t){a(t)}},r=e=>e.done?n(e.value):Promise.resolve(e.value).then(s,c);r((l=l.apply(e,t)).next())}));import{B as d,u}from"./useForm.07071468.js";import"./FormAction.9732afc1.js";import{z as h,bC as p,aF as y,A as f,aD as m,aA as b,ap as v,r as k,k as g,S as x,T as K,a0 as S,B as A,D as C,a6 as L,ac as w,a1 as T,a5 as _,ad as I,J as E,K as N,w as D,aa as B,ao as j,aB as O,aU as P,ay as M,u as R,c as F,_ as $,$ as U,ai as V,bv as H,b0 as Y,aR as z,aj as X,P as G,t as W,ce as q,o as J,am as Q,F as Z,G as ee,cf as te,a4 as le,as as ne,bw as ae}from"./vendor.84d2d683.js";/* empty css                */import{s as se,p as ce,b as re}from"./role.334f6c1b.js";import{ai as oe,f as ie,i as de,I as ue,ar as he,p as pe,b as ye,_ as fe,aN as me,aO as be,a as ve,al as ke,h as ge,aP as xe,am as Ke,aH as Se,S as Ae,aQ as Ce,z as Le,ae as we}from"./index.2956b203.js";import{B as Te,a as _e}from"./index.005634a4.js";/* empty css               */import{a as Ie}from"./menu.17e77c51.js";const Ee=[{title:"角色ID",dataIndex:"roleValue",width:60},{title:"角色名称",dataIndex:"roleName",width:200},{title:"排序",dataIndex:"orderNo",width:60},{title:"状态",dataIndex:"status",width:120,customRender:({record:e})=>(Reflect.has(e,"pendingStatus")||(e.pendingStatus=!1),h(p,{checked:!0===e.status,checkedChildren:"已启用",unCheckedChildren:"已禁用",loading:e.pendingStatus,onChange(t){e.pendingStatus=!0;const l=t,{createMessage:n}=ie();se(e.id,l).then((()=>{e.status=l,n.success("已成功修改角色状态")})).catch((()=>{n.error("修改角色状态失败")})).finally((()=>{e.pendingStatus=!1}))}})),ifShow:()=>{const{hasPermission:e}=oe();return e(["role_status"])}},{title:"创建时间",dataIndex:"createTime",width:180,format:e=>y(e).format("YYYY-MM-DD HH:mm:ss")}],Ne=[{field:"roleName",label:"角色名称",component:"Input",colProps:{span:8},componentProps:{placeholder:"请输入，支持模糊匹配"}},{field:"status",label:"状态",component:"Select",componentProps:{options:[{label:"启用",value:!0},{label:"停用",value:!1}]},colProps:{span:8}}],De=[{field:"id",label:"角色Id",component:"Input",show:!1},{field:"roleName",label:"角色名称",required:!0,component:"Input"},{field:"orderNo",label:"排序",component:"InputNumber",colProps:{span:18},componentProps:{defaultValue:99}},{field:"status",label:"状态",component:"RadioButtonGroup",defaultValue:!0,componentProps:{options:[{label:"启用",value:!0},{label:"停用",value:!1}]}},{label:" ",field:"menu",slot:"menu",component:"Input"}];const Be=({icon:e})=>e?de(e)?h(ue,{icon:e,class:"mr-1"}):ue:null;var je,Oe;(Oe=je||(je={}))[Oe.SELECT_ALL=0]="SELECT_ALL",Oe[Oe.UN_SELECT_ALL=1]="UN_SELECT_ALL",Oe[Oe.EXPAND_ALL=2]="EXPAND_ALL",Oe[Oe.UN_EXPAND_ALL=3]="UN_EXPAND_ALL",Oe[Oe.CHECK_STRICTLY=4]="CHECK_STRICTLY",Oe[Oe.CHECK_UN_STRICTLY=5]="CHECK_UN_STRICTLY";const Pe=f({name:"BasicTreeHeader",components:{BasicTitle:he,Icon:ue,Dropdown:m,Menu:b,MenuItem:b.Item,MenuDivider:b.Divider,InputSearch:v.Search},props:{helpMessage:{type:[String,Array],default:""},title:pe.string,toolbar:pe.bool,checkable:pe.bool,search:pe.bool,checkAll:pe.func,expandAll:pe.func,searchText:pe.string},emits:["strictly-change","search"],setup(e,{emit:t,slots:l}){const{t:n}=ye(),a=k(""),s=g((()=>["mr-1","w-full",{"ml-5":l.headerTitle||e.title}])),c=g((()=>{const{checkable:t}=e,l=[{label:n("component.tree.expandAll"),value:2},{label:n("component.tree.unExpandAll"),value:3,divider:t}];return t?[{label:n("component.tree.selectAll"),value:0},{label:n("component.tree.unSelectAll"),value:1,divider:t},...l,{label:n("component.tree.checkStrictly"),value:4},{label:n("component.tree.checkUnStrictly"),value:5}]:l}));const r=K((function(e){t("search",e)}),200);return x((()=>a.value),(e=>{r(e)})),x((()=>e.searchText),(e=>{e!==a.value&&(a.value=e)})),{t:n,toolbarList:c,handleMenuClick:function(l){var n,a,s,c;const{key:r}=l;switch(r){case 0:null==(n=e.checkAll)||n.call(e,!0);break;case 1:null==(a=e.checkAll)||a.call(e,!1);break;case 2:null==(s=e.expandAll)||s.call(e,!0);break;case 3:null==(c=e.expandAll)||c.call(e,!1);break;case 4:t("strictly-change",!1);break;case 5:t("strictly-change",!0)}},searchValue:a,getInputSearchCls:s}}}),Me={class:"flex px-2 py-1.5 items-center basic-tree-header"},Re={key:2,class:"flex flex-1 justify-self-stretch items-center cursor-pointer"};var Fe=fe(Pe,[["render",function(e,t,l,n,a,s){const c=S("BasicTitle"),r=S("InputSearch"),o=S("Icon"),i=S("MenuItem"),d=S("MenuDivider"),u=S("Menu"),h=S("Dropdown");return A(),C("div",Me,[e.$slots.headerTitle?L(e.$slots,"headerTitle",{key:0},void 0,!0):w("",!0),!e.$slots.headerTitle&&e.title?(A(),T(c,{key:1,helpMessage:e.helpMessage},{default:_((()=>[I(E(e.title),1)])),_:1},8,["helpMessage"])):w("",!0),e.search||e.toolbar?(A(),C("div",Re,[e.search?(A(),C("div",{key:0,class:N(e.getInputSearchCls)},[D(r,{placeholder:e.t("common.searchText"),size:"small",allowClear:"",value:e.searchValue,"onUpdate:value":t[0]||(t[0]=t=>e.searchValue=t)},null,8,["placeholder","value"])],2)):w("",!0),e.toolbar?(A(),T(h,{key:1,onClick:t[1]||(t[1]=M((()=>{}),["prevent"]))},{overlay:_((()=>[D(u,{onClick:e.handleMenuClick},{default:_((()=>[(A(!0),C(B,null,j(e.toolbarList,(e=>(A(),C(B,{key:e.value},[D(i,O(P({key:e.value})),{default:_((()=>[I(E(e.label),1)])),_:2},1040),e.divider?(A(),T(d,{key:0})):w("",!0)],64)))),128))])),_:1},8,["onClick"])])),default:_((()=>[D(o,{icon:"ion:ellipsis-vertical"})])),_:1})):w("",!0)])):w("",!0)])}],["__scopeId","data-v-05dbfd0e"]]);const $e={width:{type:Number,default:156},customEvent:{type:Object,default:null},styles:{type:Object},showIcon:{type:Boolean,default:!0},axis:{type:Object,default:()=>({x:0,y:0})},items:{type:Array,default:()=>[]}},Ue=e=>{const{item:t}=e;return D("span",{style:"display: inline-block; width: 100%; ",class:"px-4",onClick:e.handler.bind(null,t)},[e.showIcon&&t.icon&&D(ue,{class:"mr-2",icon:t.icon},null),D("span",null,[t.label])])};var Ve=f({name:"ContextMenu",props:$e,setup(e){const t=k(null),l=k(!1),n=g((()=>{const{axis:t,items:l,styles:n,width:a}=e,{x:s,y:c}=t||{x:0,y:0},i=40*(l||[]).length,d=a,u=document.body,h=u.clientWidth<s+d?s-d:s,p=u.clientHeight<c+i?c-i:c;return o(r({},n),{position:"absolute",width:`${a}px`,left:`${h+1}px`,top:`${p+1}px`,zIndex:9999})}));function a(e,t){const{handler:n,disabled:a}=e;a||(l.value=!1,null==t||t.stopPropagation(),null==t||t.preventDefault(),null==n||n())}function s(t){return t.filter((e=>!e.hidden)).map((t=>{const{disabled:n,label:c,children:r,divider:o=!1}=t,i={item:t,handler:a,showIcon:e.showIcon};return r&&0!==r.length?R(l)?D(b.SubMenu,{key:c,disabled:n,popupClassName:"context-menu__popup"},{title:()=>D(Ue,i,null),default:()=>s(r)}):null:D(B,null,[D(b.Item,{disabled:n,class:"context-menu__item",key:c},{default:()=>[D(Ue,i,null)]}),o?D(Y,{key:`d-${c}`},null):null])}))}return $((()=>{U((()=>l.value=!0))})),V((()=>{const e=R(t);e&&document.body.removeChild(e)})),()=>{let a;if(!R(l))return null;const{items:c}=e;return D("div",{class:"context-menu"},[D(b,{inlineIndent:12,mode:"vertical",ref:t,style:R(n)},(r=a=s(c),"function"==typeof r||"[object Object]"===Object.prototype.toString.call(r)&&!H(r)?a:{default:()=>[a]}))]);var r}}});const He={domList:[],resolve:()=>{}},Ye=function(e){const{event:t}=e||{};if(t&&(null==t||t.preventDefault()),be)return new Promise((l=>{const n=document.body,a=document.createElement("div"),s={};e.styles&&(s.styles=e.styles),e.items&&(s.items=e.items),e.event&&(s.customEvent=t,s.axis={x:t.clientX,y:t.clientY});const c=D(Ve,s);z(c,a);const r=function(){He.resolve("")};He.domList.push(a);const o=function(){He.domList.forEach((e=>{try{e&&n.removeChild(e)}catch(t){}})),n.removeEventListener("click",r),n.removeEventListener("scroll",r)};He.resolve=function(e){o(),l(e)},o(),n.appendChild(a),n.addEventListener("click",r),n.addEventListener("scroll",r)}))},ze=function(){He&&(He.resolve(""),He.domList=[])};var Xe=f({name:"BasicTree",inheritAttrs:!1,props:{value:{type:[Object,Array]},renderIcon:{type:Function},helpMessage:{type:[String,Array],default:""},title:pe.string,toolbar:pe.bool,search:pe.bool,searchValue:pe.string,checkStrictly:pe.bool,clickRowToExpand:pe.bool.def(!0),checkable:pe.bool.def(!1),defaultExpandLevel:{type:[String,Number],default:""},defaultExpandAll:pe.bool.def(!1),replaceFields:{type:Object},treeData:{type:Array},actionList:{type:Array,default:()=>[]},expandedKeys:{type:Array,default:()=>[]},selectedKeys:{type:Array,default:()=>[]},checkedKeys:{type:Array,default:()=>[]},beforeRightClick:{type:Function,default:null},rightMenuList:{type:Array},filterFn:{type:Function,default:null},highlight:{type:[Boolean,String],default:!1},expandOnSearch:pe.bool.def(!1),checkOnSearch:pe.bool.def(!1),selectedOnSearch:pe.bool.def(!1)},emits:["update:expandedKeys","update:selectedKeys","update:value","change","check","update:searchValue"],setup(e,{attrs:t,slots:l,emit:n,expose:a}){const s=G({checkStrictly:e.checkStrictly,expandedKeys:e.expandedKeys||[],selectedKeys:e.selectedKeys||[],checkedKeys:e.checkedKeys||[]}),c=G({startSearch:!1,searchText:"",searchData:[]}),d=k([]),[u]=function(e=!0){return X()&&e&&V((()=>{ze()})),[Ye,ze]}(),{prefixCls:h}=ve("basic-tree"),p=g((()=>{const{replaceFields:t}=e;return r({children:"children",title:"title",key:"key"},t)})),y=g((()=>{let l=o(r(r({blockNode:!0},t),e),{expandedKeys:s.expandedKeys,selectedKeys:s.selectedKeys,checkedKeys:s.checkedKeys,checkStrictly:s.checkStrictly,replaceFields:R(p),"onUpdate:expandedKeys":e=>{s.expandedKeys=e,n("update:expandedKeys",e)},"onUpdate:selectedKeys":e=>{s.selectedKeys=e,n("update:selectedKeys",e)},onCheck:(e,t)=>{let l=W(s.checkedKeys);if(ke(l)&&c.startSearch){const{key:e}=R(p);l=q(l,L(t.node.$attrs.node[e])),t.checked&&l.push(t.node.$attrs.node[e]),s.checkedKeys=l}else s.checkedKeys=e;const a=W(s.checkedKeys);n("update:value",a),n("check",a,t)},onRightClick:T});return J(l,"treeData","class")})),f=g((()=>c.startSearch?c.searchData:R(d))),m=g((()=>!f.value||0===f.value.length)),{deleteNodeByKey:b,insertNodeByKey:v,insertNodesByKey:K,filterByLevel:S,updateNodeByKey:A,getAllKeys:C,getChildrenKeys:L,getEnabledKeys:w}=function(e,t){function l(n){const a=[],s=n||R(e),{key:c,children:r}=R(t);if(!r||!c)return a;for(let e=0;e<s.length;e++){const t=s[e];a.push(t[c]);const n=t[r];n&&n.length&&a.push(...l(n))}return a}return{deleteNodeByKey:function l(n,a){if(!n)return;const s=a||R(e),{key:c,children:r}=R(t);if(r&&c)for(let e=0;e<s.length;e++){const t=s[e],a=t[r];if(t[c]===n){s.splice(e,1);break}a&&a.length&&l(n,t[r])}},insertNodeByKey:function({parentKey:l=null,node:n,push:a="push"}){const s=F(R(e));if(!l)return s[a](n),void(e.value=s);const{key:c,children:r}=R(t);r&&c&&(me(s,(e=>{if(e[c]===l)return e[r]=e[r]||[],e[r][a](n),!0})),e.value=s)},insertNodesByKey:function({parentKey:l=null,list:n,push:a="push"}){const s=F(R(e));if(n&&!(n.length<1))if(l){const{key:c,children:r}=R(t);if(!r||!c)return;me(s,(t=>{if(t[c]===l){t[r]=t[r]||[];for(let e=0;e<n.length;e++)t[r][a](n[e]);return e.value=s,!0}}))}else for(let e=0;e<n.length;e++)s[a](n[e])},filterByLevel:function l(n=1,a,s=1){if(!n)return[];const c=[],r=a||R(e)||[];for(let e=0;e<r.length;e++){const a=r[e],{key:o,children:i}=R(t),d=o?a[o]:"",u=i?a[i]:[];c.push(d),u&&u.length&&s<n&&(s+=1,c.push(...l(n,u,s)))}return c},updateNodeByKey:function l(n,a,s){if(!n)return;const c=s||R(e),{key:o,children:i}=R(t);if(i&&o)for(let e=0;e<c.length;e++){const t=c[e],s=t[i];if(t[o]===n){c[e]=r(r({},c[e]),a);break}s&&s.length&&l(n,a,t[i])}},getAllKeys:l,getChildrenKeys:function n(a,s){const c=[],r=s||R(e),{key:o,children:i}=R(t);if(!i||!o)return c;for(let e=0;e<r.length;e++){const t=r[e],s=t[i];a===t[o]?(c.push(t[o]),s&&s.length&&c.push(...l(s))):s&&s.length&&c.push(...n(a,s))}return c},getEnabledKeys:function l(n){const a=[],s=n||R(e),{key:c,children:r}=R(t);if(!r||!c)return a;for(let e=0;e<s.length;e++){const t=s[e];!0!==t.disabled&&!1!==t.selectable&&a.push(t[c]);const n=t[r];n&&n.length&&a.push(...l(n))}return a}}}(d,p);function T(t){return i(this,arguments,(function*({event:t,node:l}){var n;const{rightMenuList:a=[],beforeRightClick:s}=e;let c={event:t,items:[]};if(s&&ge(s)){let e=yield s(l,t);Array.isArray(e)?c.items=e:Object.assign(c,e)}else c.items=a;(null==(n=c.items)?void 0:n.length)&&u(c)}))}function _(e){s.expandedKeys=e}function I(e){s.selectedKeys=e}function E(e){s.checkedKeys=e}function N(e){s.checkedKeys=e?w():[]}function j(e){s.expandedKeys=e?C():[]}function O(e){s.checkStrictly=e}function P(t){if(t!==c.searchText&&(c.searchText=t),n("update:searchValue",t),!t)return void(c.startSearch=!1);const{filterFn:l,checkable:a,expandOnSearch:s,checkOnSearch:r,selectedOnSearch:o}=R(e);c.startSearch=!0;const{title:i,key:u}=R(p),h=[];if(c.searchData=xe(R(d),(e=>{var n,a;const s=l?l(t,e,R(p)):null!=(a=null==(n=e[i])?void 0:n.includes(t))&&a;return s&&h.push(e[u]),s}),R(p)),s){const e=Ke(c.searchData).map((e=>e[u]));e&&e.length&&_(e)}r&&a&&h.length&&E(h),o&&h.length&&I(h)}function M(t,l){if(e.clickRowToExpand&&l&&0!==l.length)if(s.expandedKeys.includes(t)){const e=[...s.expandedKeys],l=e.findIndex((e=>e===t));-1!==l&&e.splice(l,1),_(e)}else _([...s.expandedKeys,t])}x((()=>e.searchValue),(e=>{e!==c.searchText&&(c.searchText=e)}),{immediate:!0}),x((()=>e.treeData),(e=>{e&&P(c.searchText)})),Q((()=>{d.value=e.treeData})),$((()=>{const t=parseInt(e.defaultExpandLevel);t>0?s.expandedKeys=S(t):e.defaultExpandAll&&j(!0)})),Q((()=>{s.expandedKeys=e.expandedKeys})),Q((()=>{s.selectedKeys=e.selectedKeys})),Q((()=>{s.checkedKeys=e.checkedKeys})),x((()=>e.value),(()=>{s.checkedKeys=W(e.value||[])})),x((()=>s.checkedKeys),(()=>{const e=W(s.checkedKeys);n("update:value",e),n("change",e)})),Q((()=>{s.checkStrictly=e.checkStrictly}));function U(t){const{actionList:l}=e;if(l&&0!==l.length)return l.map(((e,l)=>{var n;let a=!0;return ge(e.show)?a=null==(n=e.show)?void 0:n.call(e,t):Le(e.show)&&(a=e.show),a?D("span",{key:l,class:`${h}__action`},[e.render(t)]):null}))}function Y({data:t,level:n}){if(!t)return null;const a=c.searchText,{highlight:s}=R(e);return t.map((t=>{var i;const{title:d,key:u,children:f}=R(p),m=J(t,"title"),b=function(t,l){return!l&&e.renderIcon&&ge(e.renderIcon)?e.renderIcon(t):l}(o(r({},t),{level:n}),t.icon),v=ae(t,f)||[],k=ae(t,d),g=a?k.indexOf(a):-1,x=c.startSearch&&!Ce(a)&&s&&-1!==g,K=`color: ${Le(s)?"#f50":s}`,S=x?D("span",{class:(null==(i=R(y))?void 0:i.blockNode)?`${h}__content`:""},[D("span",null,[k.substr(0,g)]),D("span",{style:K},[a]),D("span",null,[k.substr(g+a.length)])]):k;return D(te.TreeNode,le(m,{node:W(t),key:ae(t,u)}),{title:()=>{var e,a;return D("span",{class:`${h}-title pl-2`,onClick:M.bind(null,t[u],t[f])},[(null==(e=t.slots)?void 0:e.title)?we(l,null==(a=t.slots)?void 0:a.title,t):D(B,null,[b&&D(Be,{icon:b},null),S,D("span",{class:`${h}__actions`},[U(o(r({},t),{level:n}))])])])},default:()=>Y({data:v,level:n+1})})}))}return a({setExpandedKeys:_,getExpandedKeys:function(){return s.expandedKeys},setSelectedKeys:I,getSelectedKeys:function(){return s.selectedKeys},setCheckedKeys:E,getCheckedKeys:function(){return s.checkedKeys},insertNodeByKey:v,insertNodesByKey:K,deleteNodeByKey:b,updateNodeByKey:A,checkAll:N,expandAll:j,filterByLevel:e=>{s.expandedKeys=S(e)},setSearchValue:e=>{P(e)},getSearchValue:()=>c.searchText}),()=>{let n;const{title:a,helpMessage:s,toolbar:o,search:i,checkable:d}=e,u=a||o||i||l.headerTitle;return D("div",{class:[h,"h-full",t.class]},[u&&D(Fe,{checkable:d,checkAll:N,expandAll:j,title:a,search:i,toolbar:o,helpMessage:s,onStrictlyChange:O,onSearch:P,searchText:c.searchText},(p=n=Se(l),"function"==typeof p||"[object Object]"===Object.prototype.toString.call(p)&&!H(p)?n:{default:()=>[n]})),Z(D(Ae,{style:{height:"calc(100% - 38px)"}},{default:()=>[D(te,le(R(y),{showIcon:!1}),r({default:()=>Y({data:R(f),level:1})},Se(l)))]}),[[ee,!R(m)]]),Z(D(ne,{image:ne.PRESENTED_IMAGE_SIMPLE,class:"!mt-4"},null),[[ee,R(m)]])]);var p}}});var Ge=fe(f({name:"RoleDrawer",components:{BasicDrawer:Te,BasicForm:d,BasicTree:Xe},emits:["success","register"],setup(e,{emit:t}){const l=k(!0),n=k([]),[a,{resetFields:s,setFieldsValue:c,validate:o}]=u({labelWidth:90,baseColProps:{span:24},schemas:De,showActionButtonGroup:!1}),[d,{setDrawerProps:h,closeDrawer:p}]=_e((e=>i(this,null,(function*(){yield s(),h({confirmLoading:!1}),0===R(n).length&&(n.value=yield Ie()),l.value=!!(null==e?void 0:e.isUpdate),R(l)&&(yield c(r({},e.record)))}))));return{registerDrawer:d,registerForm:a,getTitle:g((()=>R(l)?"编辑角色":"新增角色")),handleSubmit:function(){return i(this,null,(function*(){try{const e=yield o();e.menu.checked&&(e.menu=e.menu.checked.concat(e.menu.halfChecked)),h({confirmLoading:!0}),R(l)?yield ce(e.id,e):yield re(e),p(),t("success")}finally{h({confirmLoading:!1})}}))},treeData:n}}}),[["render",function(e,t,l,n,a,s){const c=S("BasicTree"),r=S("BasicForm"),o=S("BasicDrawer");return A(),T(o,le(e.$attrs,{onRegister:e.registerDrawer,showFooter:"",title:e.getTitle,width:"500px",onOk:e.handleSubmit}),{default:_((()=>[D(r,{onRegister:e.registerForm},{menu:_((({model:t,field:l})=>[D(c,{value:t[l],"onUpdate:value":e=>t[l]=e,treeData:e.treeData,fieldNames:{title:"roleName",key:"id"},checkable:"",checkStrictly:!0,toolbar:!1,title:"角色配置"},null,8,["value","onUpdate:value","treeData"])])),_:1},8,["onRegister"])])),_:1},16,["onRegister","title","onOk"])}]]),We=Object.freeze(Object.defineProperty({__proto__:null,default:Ge},Symbol.toStringTag,{value:"Module"}));export{Ge as R,We as a,Ee as c,Ne as s};
